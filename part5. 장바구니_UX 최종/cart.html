<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>장바구니</title>
  <style>
    /* 전체 레이아웃 기본 설정 (모바일 우선) */
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #f5f5f7;
      color: #222;
    }

    .cart-page {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }

    .cart-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .cart-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* 장바구니 카드 */
    .cart-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      border-radius: 12px;
      background-color: #ffffff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
    }

    .cart-item:active {
      transform: scale(0.98);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .cart-item-image-wrap {
      flex-shrink: 0;
      width: 90px;
      height: 90px;
      border-radius: 10px;
      overflow: hidden;
      background-color: #f0f0f2;
    }

    .cart-item-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .cart-item-info {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      flex: 1;
      min-width: 0;
    }

    .cart-item-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cart-item-name {
      font-size: 0.95rem;
      font-weight: 600;
      line-height: 1.3;
      word-break: keep-all;
    }

    .cart-item-price {
      font-size: 0.9rem;
      font-weight: 700;
      color: #e53935;
    }

    .cart-item-sub-info {
      font-size: 0.8rem;
      color: #777;
    }

    /* 하단: 수량/삭제 영역 */
    .cart-item-bottom {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 8px;
    }

    .quantity-control {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      border: 1px solid #ddd;
      overflow: hidden;
      background-color: #fafafa;
    }

    .quantity-button {
      min-width: 44px;
      min-height: 44px;
      width: 44px;
      height: 44px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .quantity-button:hover {
      background-color: #ececec;
    }

    .quantity-button:active {
      background-color: #ddd;
      transform: scale(0.95);
    }

    .quantity-button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    .quantity-value {
      min-width: 44px;
      min-height: 44px;
      text-align: center;
      font-size: 1rem;
      font-weight: 600;
      border-left: 1px solid #ddd;
      border-right: 1px solid #ddd;
      padding: 0 8px;
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cart-item-delete-button {
      border: none;
      background-color: #f8d7da;
      color: #b71c1c;
      padding: 10px 16px;
      min-height: 44px;
      font-size: 0.9rem;
      border-radius: 999px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      font-weight: 600;
    }

    .cart-item-delete-button:hover {
      background-color: #f5c2c7;
    }

    .cart-item-delete-button:active {
      background-color: #f1aeb5;
      transform: scale(0.95);
    }

    /* 합계 영역 */
    .cart-summary {
      margin-top: 16px;
      padding: 16px;
      border-top: 2px solid #e0e0e0;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
    }

    .cart-summary-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .cart-summary-row:last-child {
      margin-bottom: 0;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #e0e0e0;
    }

    .cart-summary-label {
      font-size: 0.95rem;
      font-weight: 600;
      color: #333;
    }

    .cart-summary-price {
      color: #e53935;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .cart-summary-total-label {
      font-size: 1.1rem;
      font-weight: 700;
      color: #222;
    }

    /* 결제 섹션 */
    .checkout-section {
      margin-top: 24px;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
    }

    .checkout-section-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e0e0e0;
    }

    /* 주문 상품 요약 */
    .order-summary {
      margin-bottom: 24px;
      padding: 16px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    .order-summary-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: #333;
    }

    .order-summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      font-size: 0.9rem;
      border-bottom: 1px solid #e0e0e0;
    }

    .order-summary-item:last-child {
      border-bottom: none;
    }

    .order-summary-item-name {
      flex: 1;
      color: #555;
    }

    .order-summary-item-details {
      color: #777;
      font-size: 0.85rem;
      margin-left: 8px;
    }

    .order-summary-item-price {
      font-weight: 600;
      color: #333;
    }

    /* 배송 정보 폼 */
    .delivery-form {
      margin-bottom: 24px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 6px;
      color: #333;
    }

    .form-label .required {
      color: #e53935;
      margin-left: 2px;
    }

    .form-input {
      width: 100%;
      padding: 12px 14px;
      min-height: 44px;
      font-size: 1rem;
      border: 2px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
      transition: all 0.2s ease;
      -webkit-appearance: none;
      appearance: none;
    }

    .form-input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }

    .form-input.error {
      border-color: #e53935;
      animation: shake 0.3s ease;
    }

    .form-input.error:focus {
      box-shadow: 0 0 0 3px rgba(229, 57, 53, 0.1);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .error-message {
      display: block;
      margin-top: 6px;
      font-size: 0.85rem;
      color: #e53935;
      min-height: 20px;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-5px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-input.success {
      border-color: #28a745;
    }

    .form-input.success:focus {
      box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
    }

    /* 로딩 및 피드백 애니메이션 */
    .checkout-button.loading {
      position: relative;
      color: transparent;
    }

    .checkout-button.loading::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin-left: -10px;
      margin-top: -10px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: #ffffff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .form-row {
      display: flex;
      gap: 12px;
    }

    .form-row .form-group {
      flex: 1;
    }

    .form-textarea {
      width: 100%;
      padding: 12px 14px;
      font-size: 1rem;
      border: 2px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
      transition: all 0.2s ease;
      -webkit-appearance: none;
      appearance: none;
    }

    .form-textarea:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }

    /* 결제 버튼 */
    .checkout-button {
      width: 100%;
      padding: 18px;
      min-height: 56px;
      font-size: 1.1rem;
      font-weight: 700;
      color: #ffffff;
      background-color: #007bff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      position: relative;
      overflow: hidden;
    }

    .checkout-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .checkout-button:active:not(:disabled)::before {
      width: 300px;
      height: 300px;
    }

    .checkout-button:hover:not(:disabled) {
      background-color: #0056b3;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }

    .checkout-button:active:not(:disabled) {
      background-color: #004085;
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0, 123, 255, 0.2);
    }

    .checkout-button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      opacity: 0.6;
      transform: none;
      box-shadow: none;
    }

    /* 모바일 반응형 */
    @media (max-width: 599px) {
      .cart-page {
        padding: 12px;
      }

      .form-row {
        flex-direction: column;
        gap: 0;
      }

      .cart-item {
        padding: 14px;
      }

      .cart-item-bottom {
        flex-wrap: wrap;
        gap: 12px;
      }

      .quantity-control {
        flex: 1;
        min-width: 120px;
      }

      .cart-item-delete-button {
        flex: 1;
        min-width: 80px;
      }

      .checkout-section {
        padding: 16px;
      }

      .checkout-button {
        padding: 16px;
        min-height: 52px;
      }
    }

    /* 터치 디바이스 최적화 */
    @media (hover: none) and (pointer: coarse) {
      .quantity-button:hover {
        background-color: transparent;
      }

      .cart-item-delete-button:hover {
        background-color: #f8d7da;
      }

      .checkout-button:hover:not(:disabled) {
        transform: none;
        box-shadow: none;
      }
    }

    /* 태블릿 이상에서 카드 정렬 개선 */
    @media (min-width: 600px) {
      .cart-item {
        padding: 14px;
      }

      .cart-item-name {
        font-size: 1rem;
      }

      .cart-item-price {
        font-size: 0.95rem;
      }

      .checkout-section {
        padding: 24px;
      }
    }

    /* 데스크톱에서 이미지/정보 비율 조정 */
    @media (min-width: 900px) {
      .cart-item {
        gap: 16px;
      }

      .cart-item-image-wrap {
        width: 110px;
        height: 110px;
      }
    }
  </style>
</head>
<body>
  <main class="cart-page">
    <h1 class="cart-title">장바구니</h1>

    <section class="cart-list" id="cartList">
      <!-- 상품 카드들은 JavaScript로 동적 생성됩니다 -->
    </section>

    <!-- 합계 영역 -->
    <section class="cart-summary">
      <div class="cart-summary-row">
        <span class="cart-summary-label">상품 합계</span>
        <span class="cart-summary-price" id="totalPrice">167,000원</span>
      </div>
      <div class="cart-summary-row">
        <span class="cart-summary-total-label">총 결제 금액</span>
        <span class="cart-summary-price" id="finalTotalPrice">167,000원</span>
      </div>
    </section>

    <!-- 결제 섹션 -->
    <section class="checkout-section" id="checkoutSection">
      <h2 class="checkout-section-title">결제 정보</h2>

      <!-- 주문 상품 요약 -->
      <div class="order-summary" id="orderSummary">
        <div class="order-summary-title">주문 상품 요약</div>
        <!-- 상품 목록은 JavaScript로 동적 생성됩니다 -->
      </div>

      <!-- 배송 정보 입력 폼 -->
      <div class="delivery-form">
        <h3 class="order-summary-title">배송 정보</h3>
        
        <div class="form-group">
          <label class="form-label" for="receiverName">
            받는 분 <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="receiverName" 
            class="form-input" 
            placeholder="이름을 입력하세요"
            required
          >
          <span class="error-message" id="receiverNameError"></span>
        </div>

        <div class="form-group">
          <label class="form-label" for="receiverPhone">
            연락처 <span class="required">*</span>
          </label>
          <input 
            type="tel" 
            id="receiverPhone" 
            class="form-input" 
            placeholder="010-0000-0000"
            required
          >
          <span class="error-message" id="receiverPhoneError"></span>
        </div>

        <div class="form-group">
          <label class="form-label" for="postcode">
            우편번호 <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="postcode" 
            class="form-input" 
            placeholder="우편번호"
            required
          >
          <span class="error-message" id="postcodeError"></span>
        </div>

        <div class="form-group">
          <label class="form-label" for="address">
            주소 <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="address" 
            class="form-input" 
            placeholder="기본 주소"
            required
          >
          <span class="error-message" id="addressError"></span>
        </div>

        <div class="form-group">
          <label class="form-label" for="detailAddress">
            상세 주소 <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="detailAddress" 
            class="form-input" 
            placeholder="상세 주소"
            required
          >
          <span class="error-message" id="detailAddressError"></span>
        </div>

        <div class="form-group">
          <label class="form-label" for="deliveryMemo">
            배송 메모
          </label>
          <textarea 
            id="deliveryMemo" 
            class="form-textarea" 
            placeholder="배송 시 요청사항을 입력하세요 (선택사항)"
          ></textarea>
        </div>
      </div>

      <!-- 결제 버튼 -->
      <button 
        type="button" 
        class="checkout-button" 
        id="checkoutButton"
        disabled
      >
        결제하기
      </button>
    </section>
  </main>

  <script>
    // ES6 문법을 사용한 장바구니 관리 클래스 (LocalStorage 포함)
    class CartManager {
      constructor() {
        this.storageKey = 'shoppingCart';
        this.cartItems = [];
        this.init();
      }

      // 초기화
      init() {
        // LocalStorage에서 장바구니 데이터 불러오기
        this.loadCartFromStorage();
        
        // 장바구니가 비어있으면 기본 데이터 설정
        if (this.cartItems.length === 0) {
          this.setDefaultCartItems();
          this.saveCartToStorage();
        }
        
        // 장바구니 UI 렌더링
        this.renderCart();
        
        // 주문 상품 요약 렌더링
        this.renderOrderSummary();
        
        // 이벤트 리스너 설정
        this.setupEventListeners();
        
        // 결제 폼 이벤트 리스너 설정
        this.setupCheckoutFormListeners();
        
        // 초기 결제 버튼 상태 확인
        this.updateCheckoutButton();
      }

      // 기본 장바구니 데이터 설정
      setDefaultCartItems() {
        this.cartItems = [
          {
            id: '1',
            name: '화이트 베이직 스니커즈',
            image: 'https://via.placeholder.com/300x300?text=Product+1',
            imageAlt: '화이트 스니커즈',
            unitPrice: 59000,
            quantity: 1,
            option: '옵션: 260 / 화이트'
          },
          {
            id: '2',
            name: '소프트 울 니트 가디건',
            image: 'https://via.placeholder.com/300x300?text=Product+2',
            imageAlt: '니트 가디건',
            unitPrice: 79000,
            quantity: 2,
            option: '옵션: M / 크림베이지'
          },
          {
            id: '3',
            name: '데일리 코튼 에코백',
            image: 'https://via.placeholder.com/300x300?text=Product+3',
            imageAlt: '에코백',
            unitPrice: 29000,
            quantity: 1,
            option: '옵션: 아이보리'
          }
        ];
      }

      // LocalStorage에서 장바구니 데이터 불러오기
      loadCartFromStorage() {
        try {
          const storedData = localStorage.getItem(this.storageKey);
          if (storedData) {
            this.cartItems = JSON.parse(storedData);
          }
        } catch (error) {
          console.error('장바구니 데이터 불러오기 실패:', error);
          this.cartItems = [];
        }
      }

      // LocalStorage에 장바구니 데이터 저장
      saveCartToStorage() {
        try {
          localStorage.setItem(this.storageKey, JSON.stringify(this.cartItems));
        } catch (error) {
          console.error('장바구니 데이터 저장 실패:', error);
        }
      }

      // 장바구니 UI 렌더링
      renderCart() {
        const cartList = document.getElementById('cartList');
        cartList.innerHTML = '';

        if (this.cartItems.length === 0) {
          cartList.innerHTML = '<p style="text-align: center; padding: 40px; color: #777;">장바구니가 비어있습니다.</p>';
          this.updateTotalPrice();
          this.renderOrderSummary();
          this.updateCheckoutButton();
          return;
        }

        this.cartItems.forEach(item => {
          const cartItemElement = this.createCartItemElement(item);
          cartList.appendChild(cartItemElement);
        });

        this.updateTotalPrice();
        this.updateDecreaseButtons();
        this.renderOrderSummary();
        this.updateCheckoutButton();
      }

      // 장바구니 아이템 요소 생성
      createCartItemElement(item) {
        const article = document.createElement('article');
        article.className = 'cart-item';
        article.setAttribute('data-item-id', item.id);

        const totalPrice = item.unitPrice * item.quantity;

        article.innerHTML = `
          <div class="cart-item-image-wrap">
            <img src="${item.image}"
                 alt="${item.imageAlt}"
                 class="cart-item-image" />
          </div>
          <div class="cart-item-info">
            <div class="cart-item-main">
              <h2 class="cart-item-name">${item.name}</h2>
              <div class="cart-item-price" data-unit-price="${item.unitPrice}">${totalPrice.toLocaleString('ko-KR')}원</div>
              <div class="cart-item-sub-info">${item.option}</div>
            </div>
            <div class="cart-item-bottom">
              <div class="quantity-control">
                <button class="quantity-button quantity-decrease" type="button" aria-label="수량 감소">-</button>
                <span class="quantity-value">${item.quantity}</span>
                <button class="quantity-button quantity-increase" type="button" aria-label="수량 증가">+</button>
              </div>
              <button class="cart-item-delete-button" type="button">삭제</button>
            </div>
          </div>
        `;

        return article;
      }

      // 이벤트 리스너 설정
      setupEventListeners() {
        const cartList = document.getElementById('cartList');
        
        // 이벤트 위임 사용 (동적으로 생성된 요소에도 적용)
        cartList.addEventListener('click', (e) => {
          const cartItem = e.target.closest('.cart-item');
          if (!cartItem) return;

          const itemId = cartItem.getAttribute('data-item-id');

          if (e.target.classList.contains('quantity-increase')) {
            this.handleIncrease(itemId);
          } else if (e.target.classList.contains('quantity-decrease')) {
            this.handleDecrease(itemId);
          } else if (e.target.classList.contains('cart-item-delete-button')) {
            this.handleDelete(itemId);
          }
        });
      }

      // 수량 증가 처리
      handleIncrease(itemId) {
        const item = this.cartItems.find(i => i.id === itemId);
        if (!item) return;

        item.quantity += 1;
        this.saveCartToStorage();
        this.renderCart();
      }

      // 수량 감소 처리
      handleDecrease(itemId) {
        const item = this.cartItems.find(i => i.id === itemId);
        if (!item) return;

        // 수량이 1 이하로 내려가지 않도록 제한
        if (item.quantity <= 1) {
          return;
        }

        item.quantity -= 1;
        this.saveCartToStorage();
        this.renderCart();
      }

      // 상품 삭제 처리
      handleDelete(itemId) {
        if (confirm('이 상품을 장바구니에서 삭제하시겠습니까?')) {
          this.cartItems = this.cartItems.filter(item => item.id !== itemId);
          this.saveCartToStorage();
          this.renderCart();
        }
      }

      // 감소 버튼 상태 업데이트
      updateDecreaseButtons() {
        const cartItems = document.querySelectorAll('.cart-item');
        cartItems.forEach(item => {
          const quantityValue = item.querySelector('.quantity-value');
          const quantity = parseInt(quantityValue.textContent, 10);
          const decreaseButton = item.querySelector('.quantity-decrease');

          if (quantity === 1) {
            decreaseButton.disabled = true;
          } else {
            decreaseButton.disabled = false;
          }
        });
      }

      // 전체 합계 가격 업데이트
      updateTotalPrice() {
        let total = 0;

        // 모든 상품의 (단가 × 수량) 합계 계산
        this.cartItems.forEach(item => {
          total += item.unitPrice * item.quantity;
        });

        // 천 단위 콤마 표시로 포맷팅
        const formattedTotal = total.toLocaleString('ko-KR');

        // 상품 합계 업데이트
        const totalPriceElement = document.getElementById('totalPrice');
        if (totalPriceElement) {
          totalPriceElement.textContent = `${formattedTotal}원`;
        }

        // 총 결제 금액 업데이트
        const finalTotalPriceElement = document.getElementById('finalTotalPrice');
        if (finalTotalPriceElement) {
          finalTotalPriceElement.textContent = `${formattedTotal}원`;
        }
      }

      // 주문 상품 요약 렌더링
      renderOrderSummary() {
        const orderSummary = document.getElementById('orderSummary');
        if (!orderSummary) return;

        // 기존 내용 제거 (타이틀 제외)
        const title = orderSummary.querySelector('.order-summary-title');
        orderSummary.innerHTML = '';
        if (title) {
          orderSummary.appendChild(title);
        }

        if (this.cartItems.length === 0) {
          const emptyMsg = document.createElement('div');
          emptyMsg.textContent = '장바구니가 비어있습니다.';
          emptyMsg.style.cssText = 'text-align: center; padding: 20px; color: #777;';
          orderSummary.appendChild(emptyMsg);
          return;
        }

        this.cartItems.forEach(item => {
          const summaryItem = document.createElement('div');
          summaryItem.className = 'order-summary-item';
          
          const totalPrice = item.unitPrice * item.quantity;
          
          summaryItem.innerHTML = `
            <div>
              <span class="order-summary-item-name">${item.name}</span>
              <span class="order-summary-item-details">(${item.option}) × ${item.quantity}</span>
            </div>
            <div class="order-summary-item-price">${totalPrice.toLocaleString('ko-KR')}원</div>
          `;
          
          orderSummary.appendChild(summaryItem);
        });
      }

      // 결제 폼 이벤트 리스너 설정
      setupCheckoutFormListeners() {
        // 필수 입력 필드에 이벤트 리스너 추가
        const requiredFields = [
          'receiverName',
          'receiverPhone',
          'postcode',
          'address',
          'detailAddress'
        ];

        requiredFields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field) {
            // 입력 시 실시간 검증
            field.addEventListener('input', () => {
              // 연락처 자동 포맷팅
              if (fieldId === 'receiverPhone') {
                this.formatPhoneNumber(field);
              }
              this.validateField(field);
              this.updateCheckoutButton();
            });
            
            // 포커스 아웃 시 검증
            field.addEventListener('blur', () => {
              this.validateField(field);
              this.updateCheckoutButton();
            });
            
            // 포커스 시 오류 상태 초기화 (선택사항)
            field.addEventListener('focus', () => {
              field.classList.remove('error');
            });
          }
        });

        // 결제 버튼 클릭 이벤트
        const checkoutButton = document.getElementById('checkoutButton');
        if (checkoutButton) {
          checkoutButton.addEventListener('click', () => {
            this.handleCheckout();
          });
        }
      }

      // 연락처 자동 포맷팅
      formatPhoneNumber(field) {
        let value = field.value.replace(/[^0-9]/g, '');
        
        if (value.length <= 3) {
          field.value = value;
        } else if (value.length <= 7) {
          field.value = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length <= 11) {
          field.value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
        } else {
          field.value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
      }

      // 필드 유효성 검사
      validateField(field) {
        const value = field.value.trim();
        const fieldId = field.id;
        const errorElement = document.getElementById(`${fieldId}Error`);
        let isValid = false;
        let errorMessage = '';

        // 필드별 검증 로직
        switch (fieldId) {
          case 'receiverName':
            if (value.length === 0) {
              errorMessage = '받는 분 이름을 입력해주세요.';
            } else if (value.length < 2) {
              errorMessage = '이름은 2자 이상 입력해주세요.';
            } else if (!/^[가-힣a-zA-Z\s]+$/.test(value)) {
              errorMessage = '올바른 이름 형식이 아닙니다.';
            } else {
              isValid = true;
            }
            break;

          case 'receiverPhone':
            const phoneDigits = value.replace(/-/g, '');
            if (value.length === 0) {
              errorMessage = '연락처를 입력해주세요.';
            } else if (phoneDigits.length < 10 || phoneDigits.length > 11) {
              errorMessage = '연락처는 10~11자리 숫자입니다.';
            } else if (!/^01[0-9]/.test(phoneDigits)) {
              errorMessage = '010, 011, 016, 017, 018, 019로 시작해야 합니다.';
            } else {
              isValid = true;
            }
            break;

          case 'postcode':
            if (value.length === 0) {
              errorMessage = '우편번호를 입력해주세요.';
            } else if (!/^\d{5}$/.test(value)) {
              errorMessage = '우편번호는 5자리 숫자입니다.';
            } else {
              isValid = true;
            }
            break;

          case 'address':
            if (value.length === 0) {
              errorMessage = '주소를 입력해주세요.';
            } else if (value.length < 5) {
              errorMessage = '주소를 더 자세히 입력해주세요.';
            } else {
              isValid = true;
            }
            break;

          case 'detailAddress':
            if (value.length === 0) {
              errorMessage = '상세 주소를 입력해주세요.';
            } else if (value.length < 3) {
              errorMessage = '상세 주소를 더 자세히 입력해주세요.';
            } else {
              isValid = true;
            }
            break;

          default:
            isValid = value.length > 0;
            if (!isValid) {
              errorMessage = '필수 입력 항목입니다.';
            }
        }

        // 오류 메시지 표시
        if (errorElement) {
          if (isValid) {
            errorElement.textContent = '';
            field.classList.remove('error');
            field.classList.add('success');
          } else {
            errorElement.textContent = errorMessage;
            field.classList.add('error');
            field.classList.remove('success');
          }
        } else {
          // 오류 메시지 요소가 없으면 기본 동작
          if (isValid) {
            field.classList.remove('error');
          } else {
            field.classList.add('error');
          }
        }

        return isValid;
      }

      // 모든 필수 필드 검증
      validateAllFields() {
        const requiredFields = [
          'receiverName',
          'receiverPhone',
          'postcode',
          'address',
          'detailAddress'
        ];

        let allValid = true;
        requiredFields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field) {
            const isValid = this.validateField(field);
            if (!isValid) {
              allValid = false;
            }
          }
        });

        return allValid;
      }

      // 결제 버튼 상태 업데이트
      updateCheckoutButton() {
        const checkoutButton = document.getElementById('checkoutButton');
        if (!checkoutButton) return;

        // 장바구니가 비어있거나 필수 필드가 비어있으면 비활성화
        const hasItems = this.cartItems.length > 0;
        const allFieldsValid = this.validateAllFields();

        if (hasItems && allFieldsValid) {
          checkoutButton.disabled = false;
        } else {
          checkoutButton.disabled = true;
        }
      }

      // 결제 처리 (실제 결제 연동은 하지 않음)
      handleCheckout() {
        const checkoutButton = document.getElementById('checkoutButton');
        
        if (!this.validateAllFields()) {
          // 첫 번째 오류 필드로 스크롤
          const firstErrorField = document.querySelector('.form-input.error');
          if (firstErrorField) {
            firstErrorField.focus();
            firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          return;
        }

        if (this.cartItems.length === 0) {
          alert('장바구니가 비어있습니다.');
          return;
        }

        // 로딩 상태 표시
        if (checkoutButton) {
          checkoutButton.classList.add('loading');
          checkoutButton.disabled = true;
        }

        // 결제 정보 수집
        const checkoutData = {
          items: this.cartItems,
          totalPrice: this.calculateTotal(),
          deliveryInfo: {
            receiverName: document.getElementById('receiverName').value.trim(),
            receiverPhone: document.getElementById('receiverPhone').value.trim(),
            postcode: document.getElementById('postcode').value.trim(),
            address: document.getElementById('address').value.trim(),
            detailAddress: document.getElementById('detailAddress').value.trim(),
            deliveryMemo: document.getElementById('deliveryMemo').value.trim()
          }
        };

        // 실제 결제 연동은 하지 않고 시뮬레이션 (1초 후 완료)
        setTimeout(() => {
          if (checkoutButton) {
            checkoutButton.classList.remove('loading');
            checkoutButton.disabled = false;
          }
          
          // 실제 결제 연동은 하지 않고 알림만 표시
          alert(`결제가 완료되었습니다!\n\n총 결제 금액: ${checkoutData.totalPrice.toLocaleString('ko-KR')}원\n\n받는 분: ${checkoutData.deliveryInfo.receiverName}\n연락처: ${checkoutData.deliveryInfo.receiverPhone}\n주소: ${checkoutData.deliveryInfo.address} ${checkoutData.deliveryInfo.detailAddress}`);
          
          // 결제 완료 후 장바구니 비우기 (선택사항)
          // this.cartItems = [];
          // this.saveCartToStorage();
          // this.renderCart();
          // this.renderOrderSummary();
          // this.updateCheckoutButton();
        }, 1000);
      }

      // 총 금액 계산
      calculateTotal() {
        let total = 0;
        this.cartItems.forEach(item => {
          total += item.unitPrice * item.quantity;
        });
        return total;
      }
    }

    // DOM 로드 완료 후 CartManager 초기화
    document.addEventListener('DOMContentLoaded', () => {
      const cartManager = new CartManager();
    });
  </script>
</body>
</html>